定制课程 LP（Landing Page）开发需求说明（面向 Claude Code）

目标：开发一个面向学员的 LP，用户从进入页面到生成三档学习方案 → 选档 → 16 周月度计划 → 首月课程大纲的完整闭环。前台不暴露 CEFR 术语；后台以难度带+闸口控节奏。
要求：可配置、可测试、易扩展、移动优先；保留DeepSeek API 接入入口，实现 AI 规划/生成。

0. 总览

技术栈建议：Next.js 14 / React 18、TypeScript、TailwindCSS、Zustand（或 Redux Toolkit）做状态管理、Zod 做 JSON 校验、SWR/React Query 拉取、Vercel 部署（可选）。

AI 接入：提供 LLMAdapter 抽象层，默认支持 DeepSeek API；将来可替换为任意模型（Claude/GPT 等）。

国际化：i18n（中文/英语/阿语），阿语需 RTL。

可访问性：WCAG 2.1 AA；移动优先。

埋点：匿名事件流（见 §10）。

安全：不落地敏感原始回答，仅保存匿名 ID 与方案摘要；速率限制与输入清洗。

1. 用户旅程（UX Flow）

进入页：价值主张 + 语言切换（ZH/EN/AR），选择文化模式（默认 sa）。

采集信息（对话式表单）

性别、身份、母语

目标文本（1–2 句）

每日时长（25–180 分）、每周学习天数（3–6，默认 5）

截止日期（可选）

是否零基础（非零基础可选“开始快测”7 题）

生成三档方案卡（轻/标/进）

卡头：轨道 + 能力标签（不出现 A1/A2）

内容：3–4 条 “你将能…”，时间表（预计完成 YYYY-MM）、月度里程碑（1 行版）

可达性诊断条：✅/⚠️/⛔ + 一键CTA（+15 分/天 / 改 6 天/周 / 下调目标）

选档：确认强度或调整 CTA → 进入下一步

16 周月度计划（仅展示“你将能…”与里程碑，不展示 CEFR）

首月课程大纲（折叠卡片：周→日→课；每课显示 主题/今天你能/语块2–3；小角标“难度：A2/A2+”不解释）

导出/提醒：下载 Excel/PDF、加入日历、WhatsApp 提醒、预约体验课

（可选）快测：严格纯文本出题，无加粗与暗示；判分后微修复首月大纲。

2. 关键不变量（Do / Don’t）

Do：前台只显示轨道/能力标签/你将能…；展示绝对完成日期。

Don’t：前台禁止出现“CEFR/A1/A2/B1”等术语与解释。

Do：首月不得越级到 B1-；第二月仅 ≤10% 课时词块级 B1- 预热（无段落）。

Do：对阿语地区默认文化合规（sa），中性办公场景，禁用指定话题。

3. 数据与 Schema（前后端统一）

使用 Zod 或 ajv 做强校验。以下为 TS 类型（与我们一致）：

export type Gender = "male" | "female" | "prefer_not_to_say";
export type Identity = "working_adult" | "university" | "high_school";
export type Track = "work" | "travel" | "study" | "daily" | "exam";
export type DifficultyBand = "Pre-A" | "A1-" | "A1" | "A1+" | "A2-" | "A2" | "A2+" | "B1-" | "B1";

export interface Intake {
  gender: Gender;
  identity: Identity;
  native_language: "ar" | "zh" | "other";
  goal_free_text: string;
  zero_base: boolean | null;
  self_assessed_level?: "Pre-A"|"A1"|"A2"|"B1"|"B2"|"C1";
  deadline_date?: string | null;
  daily_minutes_pref?: number | null;
  study_days_per_week?: number | null; // default 5
  cultural_mode: "sa" | "gcc" | "none";
  track_override?: Track | null;
}

export interface PlanOption {
  tier: "light" | "standard" | "intensive";
  track: Track;
  ui_label_current: string;
  ui_label_target: string;
  can_do_examples: string[]; // 3–4
  daily_minutes: number;
  days_per_week: number;
  weeks: number;
  finish_date_est: string; // YYYY-MM
  lessons_total: number; // 25' lessons
  diagnosis: "green" | "yellow" | "red";
  diagnosis_tips: string[]; // e.g. ["+15min/day","6 days/week","lower target"]
  monthly_milestones_one_line: string[];
}

export interface MonthlyPlan {
  months_total: 4; // 固定 4
  milestones: Array<{
    month: 1|2|3|4;
    max_target_band: DifficultyBand; // M1 A2+, M2 A2+, M3 B1-, M4 B1
    focus: string[]; // 3–6 条
    assessment_gate: { accuracy: number; task_steps: number; fluency_pauses: number };
  }>;
}

export interface Lesson {
  index: number;
  difficulty_band: DifficultyBand;
  theme: string;
  objective: string;
  today_you_can: string; // 1 line
  keywords: string[];
  patterns: string[];
  teacher_guide: { ask: string; say: string; tip: string };
  review_patterns?: string[]; // pattern ids
  caps: {
    grammar_allow: string[];
    grammar_forbid: string[];
    listening_wpm_max: number;
    max_sentences: number;
  };
  max_task_steps: number;
}

export interface FirstMonthSyllabus {
  weeks: Array<{
    week: 1|2|3|4;
    focus: string;
    days: Array<{ day: 1|2|3|4|5; lessons: Lesson[] }>;
  }>;
}

4. 架构与模块
4.1 前端路由

/ 进入页（语言切换/文化选择）

/wizard 信息采集（对话式卡片）

/plans 三档方案卡 + 诊断

/plan/[tier] 选档确认 + 月度计划

/plan/[tier]/month1 首月大纲（可折叠）

/export 导出/提醒/预约

4.2 组件树（关键）

Header（语言/RTL 切换）

IntakeWizard（步骤条、表单、校验）

PlanCards（3 卡 + 诊断条 + CTA）

MilestonesView（4 月里程碑）

MonthOneSyllabus（Week/Day/Lesson 折叠）

QuickTest（纯文本 7 题出题/作答/结果）

ExportPanel（下载 Excel/PDF、日历/WhatsApp）

Toast/Modal（确认/错误）

4.3 状态管理（Zustand）
type AppState = {
  intake: Intake | null;
  planOptions: PlanOption[] | null;
  chosen: PlanOption | null;
  monthlyPlan: MonthlyPlan | null;
  month1: FirstMonthSyllabus | null;
  quickTest?: { answers?: string[]; score?: number; mapped_start?: string; micro_units?: string[] };
};

5. DeepSeek API 接入（必做）
5.1 环境变量

DEEPSEEK_API_KEY（必填）

DEEPSEEK_BASE_URL（如需自定义）

5.2 LLM 适配层（抽象）
export interface LLMAdapter {
  chat<TOut>(opts: { system?: string; prompt: string; temperature?: number; }): Promise<string>;
}


DeepSeek 默认实现（伪代码）：

export class DeepSeekAdapter implements LLMAdapter {
  async chat({ system, prompt, temperature=0.2 }) {
    const res = await fetch(process.env.DEEPSEEK_BASE_URL ?? "https://api.deepseek.com/v1/chat/completions", {
      method: "POST",
      headers: { "Authorization": `Bearer ${process.env.DEEPSEEK_API_KEY}`, "Content-Type":"application/json" },
      body: JSON.stringify({
        model: "deepseek-chat", // 或你指定的模型
        messages: [
          system ? { role:"system", content: system } : null,
          { role:"user", content: prompt }
        ].filter(Boolean),
        temperature
      })
    });
    const data = await res.json();
    return data.choices?.[0]?.message?.content ?? "";
  }
}


要求：所有 AI 交互只能通过 LLMAdapter；后续切换模型仅替换适配器。

6. AI 提示词与阶段调用（约束与流程）

System Prompt（固定）：放在服务端，所有调用复用；详见我们已定的 System 文案（不暴露 CEFR，16 周节奏，Month Caps，Gates，CAPS，文化合规等）。

6.1 阶段 1：三档方案（PlanOption[]）

输入：Intake JSON

输出：严格符合 PlanOption[] 的 JSON

校验失败 → 走 REPAIR（结构修复）

注意：若含 deadline，比较剩余周数；否则对 B1 目标默认 16 周参考

6.2 阶段 2：16 周月度计划（MonthlyPlan）

输入：选档 PlanOption + Intake

输出：MonthlyPlan JSON（M1=A2+ / M2=A2+≤10% 词块级 B1- / M3=B1- / M4=B1）

6.3 阶段 3：首月课程大纲（FirstMonthSyllabus）

输入：MonthlyPlan（取 Month1 Caps）+ PlanOption（时长/天数）+ Intake（track/culture）

输出：FirstMonthSyllabus JSON（仅 A2/A2+；每周复现≥2 语块；Teacher Notes 不直接展示给学员）

6.4 快测（可选）

出题：严格纯文本，不加粗、不暗示（独立 Prompt，见附录 A）。

答案键：后台生成，不发送给学员。

判分：映射起点（Pre-A/A1/A2/B1），产出 micro_units，写回 AppState.quickTest；如映射为 A2，则用增量小时重新生成三档方案（可供用户选择是否重算）。

6.5 合规扫描 & 降级重写

对首月大纲各课文本做扫描；命中禁词/关系/地点 → 最小改写为中性办公等价。

7. 可视化与 UI 细节

三卡：

标题： <当前标签 → 目标标签>（轻/标准/进阶）

你将能…（3–4 条）

时间表：每天 X 分 × 每周 Y 天 → 完成 YYYY-MM（N 周 / L 课）

诊断条：背景色（绿/黄/红），右侧 CTA（按钮）

月度里程碑：

M1：3–5 点 + “本月上限 A2+，不触 B1-”

M2：注明“≤10% 词块级 B1- 预热，不计入达成”

M3/M4：里程碑 + 闸口一行提示

首月课表（可折叠卡）：

Week 卡片 → 展开 Day → 展开 Lesson

Lesson 行：主题 | 今天你能（1句） | 语块 2–3 条 | (小角标：难度 A2/A2+)

教师内部字段（caps/max_task_steps/teacher_guide）不展示给学员

移动端：卡片化，≥16px 字体，≥44pt 触达；RTL 支持阿语。

8. 导出与提醒

下载：

Excel：Week | Day | Lesson# | Difficulty | 主题 | 今天你能 | 关键词 | 语块 | 复现自 | TeacherAsk | TeacherSay | TeacherTip | Caps.max_task_steps

PDF：面向学员（隐藏教师字段）

提醒：

iCal 文件（每工作日固定时段）

WhatsApp/短信（留出 Webhook 位，默认模拟）

9. 质量保障（QA）

Schema 校验：所有 AI 输出先 JSON → zod.safeParse；失败即走 REPAIR Prompt。

防泄题快测：纯文本渲染容器 <pre>；答案键与出题分离调用。

越级守卫：校验 difficulty_band 不超过 MonthlyPlan 中 max_target_band（M1=A2+）。

文化合规：敏感词扫描；不通过则降级改写。

加载与失败状态：Skeleton/Retry/错误提示（不暴露系统细节）。

E2E 测试：Cypress 走通：采集→三卡→选档→生成→导出。

10. 埋点（匿名）

intake_completed

track_detected（work/travel/study/daily/exam）

plan_shown、diagnosis_color（green/yellow/red）

plan_selected_tier（light/standard/intensive）

monthly_plan_rendered、first_month_rendered

quicktest_started/finished（可选）

export_clicked、reminder_optin、trial_booked

仅匿名 ID + 时间戳，不采集敏感文本。

11. 验收标准（Acceptance Criteria）

不暴露 CEFR：前台所有页面/导出均无 A1/A2/B1 文案。

16 周节奏：M1=A2+；M2=A2+（≤10% 词块级 B1-预热，无段落）；M3=B1-；M4=B1。

首月课表：所有 lesson.difficulty_band ∈ {A2, A2+}；每周含 review_patterns。

三档方案：均显示完成 YYYY-MM 与可达性诊断；CTA 可调整参数并重算。

DeepSeek 接口：通过 .env 配置，LLMAdapter 可替换；所有调用经适配层。

快测：出题纯文本，无加粗/暗示；答案键后台保留；判分 JSON 正确映射。

Schema 严格：任意 AI 阶段输出必须通过校验；失败自动 REPAIR 成功。

阿语 RTL：UI 正常镜像、排版无错位。

移动端体验：≤3 步完成采集，卡片滚动流畅。

导出：Excel 与 PDF 可下载，Excel 列头与数据一致。

12. 示例 Prompt（服务端持有，供 Claude Code 调用）

System Prompt：使用我们已有的“全局 System”（不暴露 CEFR、16周节奏、Gates/CAPS、文化合规）。

阶段 Prompt：

生成三档方案（PlanOption[]）

生成月度计划（MonthlyPlan）

生成首月大纲（FirstMonthSyllabus）

REPAIR（JSON 修复）

合规扫描与最小改写

快测出题/答案键/判分（防泄题 v2）

Claude Code 需把 Prompt 常量化存放于 server/prompts/*.ts，统一从 LLMAdapter 调用。

13. 目录建议（Next.js）
/app
  /page.tsx                 // 进入页
  /wizard/page.tsx          // 采集信息
  /plans/page.tsx           // 三卡
  /plan/[tier]/page.tsx     // 选档确认 + 月度计划
  /plan/[tier]/month1/page.tsx // 首月大纲
  /export/page.tsx          // 导出/提醒
/components
  IntakeWizard.tsx
  PlanCards.tsx
  MilestonesView.tsx
  MonthOneSyllabus.tsx
  QuickTest.tsx
  ComplianceBadge.tsx
/lib
  llm/adapter.ts            // LLMAdapter接口
  llm/deepseek.ts           // DeepSeek实现
  prompts/*.ts              // 各阶段提示词
  schema/*.ts               // Zod schema
  calc/time.ts              // 周数/完成日期计算
  diagnosis/index.ts        // 可达性诊断
  i18n/*
/server
  routes/*                  // API 路由（edge）
  services/*                // 业务编排（调用 LLMAdapter）

14. 风险与对策

模型越级输出 → Caps & Month Caps 双重校验 + REPAIR 重写

快测泄题（加粗/提示） → 纯文本出题容器、出题/答案键/判分分离

文化不合规 → 文本扫描 + 最小改写

长文 JSON 失败 → 分块生成、严格 schema 校验与回退

多语言/RTL → i18n + RTL 断点测试、组件级样式隔离

15. 交付期望（一次通过）

代码：类型完备（TS）、通过 ESLint/Prettier；核心函数单测（Zod 校验、诊断计算、时间计算）。

文案常量化：可配置 Track/标签/Can-Do；避免硬编码中文。

演示数据：提供 2 份 Mock Intake（职场/旅行），能跑通端到端流程。

README：如何配置 DEEPSEEK_API_KEY、如何切换模型、如何本地运行与部署。