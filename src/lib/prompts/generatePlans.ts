import { Intake } from '@/types';

export const createGeneratePlansPrompt = (intake: Intake): string => {
  const {
    gender,
    identity,
    native_language,
    goal_free_text,
    zero_base,
    self_assessed_level,
    deadline_date,
    daily_minutes_pref,
    study_days_per_week,
    cultural_mode,
    track_override,
  } = intake;

  return `è¯·ä¸ºä»¥ä¸‹å­¦å‘˜ç”Ÿæˆä¸‰æ¡£å­¦ä¹ æ–¹æ¡ˆï¼ˆè½»é‡/æ ‡å‡†/è¿›é˜¶ï¼‰ï¼š

## å­¦å‘˜ä¿¡æ¯
- **æ€§åˆ«**ï¼š${gender}
- **èº«ä»½**ï¼š${identity}
- **æ¯è¯­**ï¼š${native_language}
- **å­¦ä¹ ç›®æ ‡**ï¼š${goal_free_text}
- **åŸºç¡€æƒ…å†µ**ï¼š${zero_base ? 'é›¶åŸºç¡€' : self_assessed_level ? `è‡ªè¯„æ°´å¹³ï¼š${self_assessed_level}` : 'æœªæä¾›'}
- **æ—¶é—´å®‰æ’**ï¼šæ¯æ—¥${daily_minutes_pref || 'æœªæŒ‡å®š'}åˆ†é’Ÿï¼Œæ¯å‘¨${study_days_per_week || 5}å¤©
- **ç›®æ ‡æœŸé™**ï¼š${deadline_date || 'æ— é™åˆ¶'}
- **æ–‡åŒ–æ¨¡å¼**ï¼š${cultural_mode}
- **æŒ‡å®šè½¨é“**ï¼š${track_override || 'è‡ªåŠ¨æ£€æµ‹'}

## è¾“å‡ºè¦æ±‚
è¯·è¿”å›ä¸¥æ ¼çš„JSONæ ¼å¼ï¼ŒåŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

\`\`\`json
{
  "plans": [
    {
      "tier": "light|standard|intensive",
      "track": "work|travel|study|daily|exam",
      "ui_label_current": "å½“å‰èƒ½åŠ›æè¿°",
      "ui_label_target": "ç›®æ ‡èƒ½åŠ›æè¿°",
      "can_do_examples": ["ä½ èƒ½åš...", "ä½ èƒ½åš...", "ä½ èƒ½åš..."],
      "daily_minutes": 25-180,
      "days_per_week": 3-6,
      "weeks": æ€»å‘¨æ•°,
      "finish_date_est": "YYYY-MM",
      "lessons_total": æ€»è¯¾ç¨‹æ•°,
      "diagnosis": "green|yellow|red",
      "diagnosis_tips": ["å»ºè®®1", "å»ºè®®2", "å»ºè®®3"],
      "monthly_milestones_one_line": ["ç¬¬1æœˆé‡Œç¨‹ç¢‘æè¿°", "ç¬¬2æœˆé‡Œç¨‹ç¢‘æè¿°", ...]
    }
  ]
}
\`\`\`

## é‡è¦æé†’
âš ï¸ **monthly_milestones_one_lineæ•°ç»„åº”è¯¥åŸºäºå®é™…å­¦ä¹ æœˆæ•°ç”Ÿæˆ**ï¼š
- çŸ­æœŸå­¦ä¹ ï¼ˆâ‰¤4å‘¨ï¼‰ï¼šç”Ÿæˆ1ä¸ªæœˆé‡Œç¨‹ç¢‘
- ä¸­æœŸå­¦ä¹ ï¼ˆâ‰¤8å‘¨ï¼‰ï¼šç”Ÿæˆ2ä¸ªæœˆé‡Œç¨‹ç¢‘
- è¾ƒé•¿æœŸå­¦ä¹ ï¼ˆâ‰¤12å‘¨ï¼‰ï¼šç”Ÿæˆ3ä¸ªæœˆé‡Œç¨‹ç¢‘
- é•¿æœŸå­¦ä¹ ï¼ˆ>12å‘¨ï¼‰ï¼šç”Ÿæˆ4ä¸ªæœˆé‡Œç¨‹ç¢‘
- æ¯ä¸ªé‡Œç¨‹ç¢‘ä»£è¡¨çº¦4å‘¨çš„å­¦ä¹ è¿›å±•

## ä¸‰æ¡£æ–¹æ¡ˆè¯´æ˜
1. **è½»é‡ (light)**ï¼šé€‚åˆæ—¶é—´è¾ƒå°‘çš„å­¦å‘˜ï¼Œæ¯å¤©25-60åˆ†é’Ÿ
2. **æ ‡å‡† (standard)**ï¼šé€‚åˆå¸¸è§„å­¦ä¹ çš„å­¦å‘˜ï¼Œæ¯å¤©60-90åˆ†é’Ÿ
3. **è¿›é˜¶ (intensive)**ï¼šé€‚åˆå¿«é€Ÿæå‡çš„å­¦å‘˜ï¼Œæ¯å¤©90-180åˆ†é’Ÿ

## è¯Šæ–­è§„åˆ™
- **ç»¿è‰² (green)**ï¼šå­¦ä¹ è®¡åˆ’å®Œå…¨å¯è¡Œ
- **é»„è‰² (yellow)**ï¼šéœ€è¦é€‚å½“è°ƒæ•´ï¼ˆå¢åŠ æ—¶é—´/é™ä½ç›®æ ‡ï¼‰
- **çº¢è‰² (red)**ï¼šç›®æ ‡è¿‡é«˜ï¼Œéœ€è¦å¤§å¹…è°ƒæ•´

## è®¡ç®—è§„åˆ™ï¼ˆå¿…é¡»ä¸¥æ ¼éµå¾ªï¼‰
âš ï¸ **ä¸¥ç¦ä½¿ç”¨ç¡¬ç¼–ç çš„å‘¨æ•°ï¼Œå¿…é¡»æ ¹æ®ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š**

### åŸºç¡€è®¡ç®—å¸¸é‡
- **æ¯è¯¾æ—¶æ—¶é•¿**ï¼š25åˆ†é’Ÿ
- **åŸºç¡€å­¦ä¹ éœ€æ±‚**ï¼š
  - é›¶åŸºç¡€ â†’ èŒåœºæ²Ÿé€šï¼šéœ€è¦çº¦240å°æ—¶ï¼ˆ240*60=14400åˆ†é’Ÿï¼‰
  - æœ‰åŸºç¡€ â†’ èŒåœºç†Ÿç»ƒï¼šéœ€è¦çº¦180å°æ—¶ï¼ˆ180*60=10800åˆ†é’Ÿï¼‰
  - æœ‰åŸºç¡€ â†’ å•†åŠ¡ç²¾é€šï¼šéœ€è¦çº¦120å°æ—¶ï¼ˆ120*60=7200åˆ†é’Ÿï¼‰

### å‘¨æ•°è®¡ç®—å…¬å¼
**å¿…é¡»ä½¿ç”¨è¿™ä¸ªå…¬å¼è®¡ç®—å‘¨æ•°ï¼š**
\`\`\`
æ€»å‘¨æ•° = Math.ceil(æ€»åˆ†é’Ÿéœ€æ±‚ / (æ¯æ—¥åˆ†é’Ÿæ•° Ã— æ¯å‘¨å¤©æ•°))
\`\`\`

### ä¸‰æ¡£æ–¹æ¡ˆçš„æ—¶é—´é…ç½®
1. **è½»é‡ (light)**ï¼š
   - æ¯æ—¥ï¼š${Math.max(25, (daily_minutes_pref || 60) * 0.7)}åˆ†é’Ÿ
   - æ¯å‘¨ï¼š${Math.max(3, (study_days_per_week || 5) - 1)}å¤©
2. **æ ‡å‡† (standard)**ï¼š
   - æ¯æ—¥ï¼š${daily_minutes_pref || 60}åˆ†é’Ÿ
   - æ¯å‘¨ï¼š${study_days_per_week || 5}å¤©
3. **è¿›é˜¶ (intensive)**ï¼š
   - æ¯æ—¥ï¼š${Math.min(180, (daily_minutes_pref || 60) * 1.5)}åˆ†é’Ÿ
   - æ¯å‘¨ï¼š${Math.min(6, (study_days_per_week || 5) + 1)}å¤©

### è¯¾ç¨‹æ•°è®¡ç®—
**å¿…é¡»ä½¿ç”¨è¿™ä¸ªå…¬å¼è®¡ç®—æ€»è¯¾ç¨‹æ•°ï¼š**
\`\`\`
æ€»è¯¾ç¨‹æ•° = Math.ceil(æ€»åˆ†é’Ÿéœ€æ±‚ / 25)
\`\`\`

### å®Œæˆæ—¶é—´è®¡ç®—
**å®Œæˆæœˆä»½ = å½“å‰æœˆä»½ + è®¡ç®—å‘¨æ•°**

### ç¤ºä¾‹è®¡ç®—è¿‡ç¨‹
å‡è®¾ï¼šæ¯æ—¥60åˆ†é’Ÿï¼Œæ¯å‘¨5å¤©ï¼Œé›¶åŸºç¡€å­¦å‘˜
1. æ€»éœ€æ±‚ï¼š14400åˆ†é’Ÿ
2. æ¯å‘¨å­¦ä¹ ï¼š60 Ã— 5 = 300åˆ†é’Ÿ
3. è®¡ç®—å‘¨æ•°ï¼šMath.ceil(14400 / 300) = 48å‘¨
4. æ€»è¯¾ç¨‹æ•°ï¼šMath.ceil(14400 / 25) = 576è¯¾

- æ ¹æ®æ¯è¯­å’Œå­¦ä¹ ç›®æ ‡è‡ªåŠ¨æ£€æµ‹æœ€é€‚åˆçš„å­¦ä¹ è½¨é“
- å¦‚æœ‰deadlineï¼Œè®¡ç®—æ‰€éœ€å‘¨æ•°æ˜¯å¦è¶³å¤Ÿ
- **æ¯æœˆé‡Œç¨‹ç¢‘è¦ä½“ç°æ¸è¿›å¼æå‡**ï¼šç¬¬1æœˆåŸºç¡€ â†’ ç¬¬2æœˆæå‡ â†’ ç¬¬3æœˆè¿›é˜¶ â†’ ç¬¬4æœˆç²¾é€š

## æœˆåº¦é‡Œç¨‹ç¢‘ç¤ºä¾‹
æ ¹æ®å®é™…å­¦ä¹ æ—¶é•¿ç”Ÿæˆé‡Œç¨‹ç¢‘ï¼š

**è½»é‡æ–¹æ¡ˆï¼ˆå¦‚33å‘¨/8ä¸ªæœˆï¼‰ï¼š**
- ç¬¬1æœˆï¼šæŒæ¡åŸºç¡€è¯æ±‡å’Œç®€å•å¯¹è¯
- ç¬¬2æœˆï¼šæå‡æ—¥å¸¸äº¤æµèƒ½åŠ›
- ç¬¬3æœˆï¼šå­¦ä¼šåŸºç¡€ä¸“ä¸šè¡¨è¾¾
- ç¬¬4æœˆï¼šå·©å›ºåŸºç¡€æ²Ÿé€šèƒ½åŠ›
- ç¬¬5æœˆï¼šæ‰©å±•è¯æ±‡å’Œè¡¨è¾¾èŒƒå›´
- ç¬¬6æœˆï¼šæå‡ä¸“ä¸šåœºæ™¯åº”ç”¨
- ç¬¬7æœˆï¼šå¼ºåŒ–ç»¼åˆæŠ€èƒ½è®­ç»ƒ
- ç¬¬8æœˆï¼šè¾¾åˆ°é¢„æœŸå­¦ä¹ ç›®æ ‡

**æ ‡å‡†æ–¹æ¡ˆï¼ˆå¦‚18å‘¨/4.5ä¸ªæœˆï¼‰ï¼š**
- ç¬¬1æœˆï¼šæŒæ¡åŸºç¡€è¯æ±‡å’Œç®€å•å¯¹è¯
- ç¬¬2æœˆï¼šæå‡æ—¥å¸¸äº¤æµèƒ½åŠ›
- ç¬¬3æœˆï¼šå­¦ä¼šä¸“ä¸šé¢†åŸŸè¡¨è¾¾
- ç¬¬4æœˆï¼šè¾¾åˆ°æµåˆ©åº”ç”¨æ°´å¹³

**è¿›é˜¶æ–¹æ¡ˆï¼ˆå¦‚10å‘¨/2.5ä¸ªæœˆï¼‰ï¼š**
- ç¬¬1æœˆï¼šå¿«é€ŸæŒæ¡åŸºç¡€è¯æ±‡å’Œå¯¹è¯
- ç¬¬2æœˆï¼šå¿«é€Ÿæå‡åº”ç”¨èƒ½åŠ›
- ç¬¬3æœˆï¼šè¾¾æˆé¢„æœŸç›®æ ‡

## æ³¨æ„äº‹é¡¹
1. **ç¦æ­¢ä½¿ç”¨CEFRæœ¯è¯­**ï¼šä¸è¦å‡ºç°A1ã€A2ã€B1ç­‰æœ¯è¯­
2. **ç›®æ ‡è¦å…·ä½“**ï¼šæ¯é¡¹"ä½ èƒ½åš..."è¦å…·ä½“å¯è¡¡é‡
3. **æ—¶é—´è¦ç°å®**ï¼šç¡®ä¿å­¦ä¹ è®¡åˆ’åœ¨æŒ‡å®šæ—¶é—´å†…å¯å®Œæˆ
4. **æ–‡åŒ–è¦åˆè§„**ï¼šå†…å®¹è¦ç¬¦åˆ${cultural_mode}æ–‡åŒ–æ¨¡å¼
5. **æ ¹æ®å®é™…å‘¨æ•°ç”Ÿæˆé‡Œç¨‹ç¢‘**ï¼šä½“ç°ä¸åŒæ–¹æ¡ˆçš„æ—¶é•¿å·®å¼‚

è¯·åŸºäºä»¥ä¸Šä¿¡æ¯ç”Ÿæˆä¸‰æ¡£ä¸ªæ€§åŒ–çš„å­¦ä¹ æ–¹æ¡ˆï¼Œç¡®ä¿æ¯ä¸ªæ–¹æ¡ˆçš„é‡Œç¨‹ç¢‘æ•°é‡åæ˜ å…¶å®é™…å­¦ä¹ æ—¶é•¿ã€‚

## ğŸ”´ è®¡ç®—éªŒè¯è¦æ±‚ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
åœ¨ç”ŸæˆJSONä¹‹å‰ï¼Œè¯·å…ˆå±•ç¤ºä½ çš„è®¡ç®—è¿‡ç¨‹ï¼š

**å­¦å‘˜åŸºç¡€ï¼š** ${zero_base ? 'é›¶åŸºç¡€' : self_assessed_level || 'æœªçŸ¥'}
**æ€»éœ€æ±‚åˆ†é’Ÿæ•°ï¼š** ${zero_base ? '14400' : self_assessed_level && ['B2', 'C1'].includes(self_assessed_level) ? '7200' : '10800'}

**è½»é‡æ–¹æ¡ˆè®¡ç®—ï¼š**
- æ¯æ—¥ï¼š${Math.max(25, (daily_minutes_pref || 60) * 0.7)}åˆ†é’Ÿ
- æ¯å‘¨ï¼š${Math.max(3, (study_days_per_week || 5) - 1)}å¤©
- æ¯å‘¨æ€»è®¡ï¼š${Math.max(25, (daily_minutes_pref || 60) * 0.7) * Math.max(3, (study_days_per_week || 5) - 1)}åˆ†é’Ÿ
- è®¡ç®—å‘¨æ•°ï¼šMath.ceil(${zero_base ? '14400' : self_assessed_level && ['B2', 'C1'].includes(self_assessed_level) ? '7200' : '10800'} / ${Math.max(25, (daily_minutes_pref || 60) * 0.7) * Math.max(3, (study_days_per_week || 5) - 1)}) = ${Math.ceil((zero_base ? 14400 : self_assessed_level && ['B2', 'C1'].includes(self_assessed_level) ? 7200 : 10800) / (Math.max(25, (daily_minutes_pref || 60) * 0.7) * Math.max(3, (study_days_per_week || 5) - 1)))}å‘¨

**æ ‡å‡†æ–¹æ¡ˆè®¡ç®—ï¼š**
- æ¯æ—¥ï¼š${daily_minutes_pref || 60}åˆ†é’Ÿ
- æ¯å‘¨ï¼š${study_days_per_week || 5}å¤©
- æ¯å‘¨æ€»è®¡ï¼š${(daily_minutes_pref || 60) * (study_days_per_week || 5)}åˆ†é’Ÿ
- è®¡ç®—å‘¨æ•°ï¼šMath.ceil(${zero_base ? '14400' : self_assessed_level && ['B2', 'C1'].includes(self_assessed_level) ? '7200' : '10800'} / ${(daily_minutes_pref || 60) * (study_days_per_week || 5)}) = ${Math.ceil((zero_base ? 14400 : self_assessed_level && ['B2', 'C1'].includes(self_assessed_level) ? 7200 : 10800) / ((daily_minutes_pref || 60) * (study_days_per_week || 5)))}å‘¨

**è¿›é˜¶æ–¹æ¡ˆè®¡ç®—ï¼š**
- æ¯æ—¥ï¼š${Math.min(180, (daily_minutes_pref || 60) * 1.5)}åˆ†é’Ÿ
- æ¯å‘¨ï¼š${Math.min(6, (study_days_per_week || 5) + 1)}å¤©
- æ¯å‘¨æ€»è®¡ï¼š${Math.min(180, (daily_minutes_pref || 60) * 1.5) * Math.min(6, (study_days_per_week || 5) + 1)}åˆ†é’Ÿ
- è®¡ç®—å‘¨æ•°ï¼šMath.ceil(${zero_base ? '14400' : self_assessed_level && ['B2', 'C1'].includes(self_assessed_level) ? '7200' : '10800'} / ${Math.min(180, (daily_minutes_pref || 60) * 1.5) * Math.min(6, (study_days_per_week || 5) + 1)}) = ${Math.ceil((zero_base ? 14400 : self_assessed_level && ['B2', 'C1'].includes(self_assessed_level) ? 7200 : 10800) / (Math.min(180, (daily_minutes_pref || 60) * 1.5) * Math.min(6, (study_days_per_week || 5) + 1)))}å‘¨

**è¯·ç¡®è®¤ä½ ç†è§£äº†è¿™äº›è®¡ç®—ç»“æœï¼Œç„¶ååœ¨JSONä¸­ä½¿ç”¨è¿™äº›è®¡ç®—å‡ºçš„å‡†ç¡®å‘¨æ•°ï¼Œä¸¥ç¦ä½¿ç”¨16æˆ–å…¶ä»–ç¡¬ç¼–ç å€¼ï¼**`;
};

export const QUICK_TEST_PROMPT_TEMPLATE = `è¯·ä¸ºè‹±è¯­å­¦ä¹ è€…ç”Ÿæˆ7é“å¿«é€Ÿæµ‹è¯•é¢˜ï¼Œç”¨äºè¯„ä¼°å½“å‰è‹±è¯­æ°´å¹³ï¼š

## æµ‹è¯•è¦æ±‚
1. **çº¯æ–‡æœ¬æ ¼å¼**ï¼šä¸è¦ä½¿ç”¨åŠ ç²—ã€æ–œä½“ç­‰æ ¼å¼
2. **éš¾åº¦é€’è¿›**ï¼šä»ç®€å•åˆ°å¤æ‚ï¼Œè¦†ç›–ä¸åŒæ°´å¹³
3. **å®ç”¨æ€§å¼º**ï¼šé¢˜ç›®è´´è¿‘å®é™…ä½¿ç”¨åœºæ™¯
4. **æ–‡åŒ–ä¸­æ€§**ï¼šé¿å…æ•æ„Ÿè¯é¢˜ï¼Œé€‚åˆä¸­æ–‡æ–‡åŒ–ç¯å¢ƒ

## é¢˜ç›®ç±»å‹
- è¯æ±‡ç†è§£ï¼šé€‰æ‹©æ­£ç¡®çš„è¯æ±‡å¡«ç©º
- è¯­æ³•åº”ç”¨ï¼šé€‰æ‹©æ­£ç¡®çš„è¯­æ³•ç»“æ„
- é˜…è¯»ç†è§£ï¼šåŸºäºçŸ­æ–‡å›ç­”é—®é¢˜
- æƒ…æ™¯å¯¹è¯ï¼šé€‰æ‹©åˆé€‚çš„è¡¨è¾¾æ–¹å¼

## è¾“å‡ºæ ¼å¼
\`\`\`json
{
  "questions": [
    {
      "id": 1,
      "type": "vocabulary|grammar|reading|dialogue",
      "question": "é¢˜ç›®å†…å®¹ï¼ˆçº¯æ–‡æœ¬ï¼‰",
      "options": ["é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C", "é€‰é¡¹D"],
      "correct_answer": "A|B|C|D",
      "explanation": "ç­”æ¡ˆè§£é‡Š"
    }
  ],
  "answer_key": {
    "1": "A",
    "2": "B",
    "3": "C",
    "4": "D",
    "5": "A",
    "6": "B",
    "7": "C"
  }
}
\`\`\`

## éš¾åº¦åˆ†å¸ƒ
- é¢˜ç›®1-2ï¼šåŸºç¡€æ°´å¹³ï¼ˆPre-A, A1-ï¼‰
- é¢˜ç›®3-4ï¼šåˆçº§æ°´å¹³ï¼ˆA1, A1+ï¼‰
- é¢˜ç›®5-6ï¼šä¸­çº§æ°´å¹³ï¼ˆA2-, A2, A2+ï¼‰
- é¢˜ç›®7ï¼šä¸­é«˜çº§æ°´å¹³ï¼ˆB1-ï¼‰

è¯·ç¡®ä¿é¢˜ç›®ä¸åŒ…å«ä»»ä½•æ ¼å¼æç¤ºï¼Œé¿å…æ³„éœ²ç­”æ¡ˆã€‚`;